CONSOLIDATED STATEMENTS OF CASH FLOWS - USD ($) $ in Thousands,12 Months Ended,,
,"Dec. 31, 2019","Dec. 31, 2018","Dec. 31, 2017"
Cash flows from operating activities,,,
Net income (loss)," $ 1,465,659 "," $ 1,205,596 "," $ (108,063)"
Adjustments to reconcile net income (loss) to net cash provided by operating activities:,,,
Depreciation and amortization expense," 465,549 "," 425,498 "," 395,867 "
Stock-based compensation expense," 378,025 "," 326,228 "," 433,806 "
Amortization of discount on convertible notes," 113,298 "," 105,926 "," 80,061 "
Deferred income taxes," 84,369 "," 43,409 ","(6,415)"
Deferred tax assets valuation allowance release, 0 ,"(845,129)", 0 
Deferred tax assets establishment related to intra-entity transfers of intangible assets,"(1,206,880)", 0 , 0 
Impairment of investments in privately-held companies," 1,550 "," 3,000 "," 62,439 "
Other adjustments,"(16,906)","(14,139)"," 5,753 "
"Changes in assets and liabilities, net of assets acquired and liabilities assumed from acquisitions:",,,
Accounts receivable,"(67,000)","(130,871)"," 2,668 "
Prepaid expenses and other assets,"(29,602)"," 126,470 ","(13,974)"
Operating lease right-of-use assets," 149,880 ", 0 , 0 
Accounts payable," 2,946 ","(1,533)"," 8,371 "
Accrued and other liabilities," 92,681 "," 95,256 ","(29,304)"
Operating lease liabilities,"(130,205)", 0 , 0 
Net cash provided by operating activities," 1,303,364 "," 1,339,711 "," 831,209 "
Cash flows from investing activities,,,
Purchases of property and equipment,"(540,688)","(483,934)","(160,742)"
Proceeds from sales of property and equipment," 6,158 "," 13,070 "," 2,783 "
Purchases of marketable securities,"(5,798,111)","(5,334,396)","(2,687,214)"
Proceeds from maturities of marketable securities," 4,928,097 "," 3,732,973 "," 2,579,747 "
Proceeds from sales of marketable securities," 367,116 "," 58,721 "," 124,826 "
Purchases of investments in privately-held companies,"(51,163)","(3,375)",(825)
Proceeds from sales of long-lived assets," 11,781 ", 0 ," 35,000 "
"Business combinations, net of cash acquired","(29,664)","(33,572)", 0 
Other investing activities,"(9,500)","(5,000)","(10,101)"
Net cash used in investing activities,"(1,115,974)","(2,055,513)","(116,526)"
Cash flows from financing activities,,,
Proceeds from issuance of senior notes," 700,000 ", 0 , 0 
Proceeds from issuance of convertible notes, 0 ," 1,150,000 ", 0 
Purchases of convertible note hedges, 0 ,"(267,950)", 0 
Proceeds from issuance of warrants concurrent with note hedges, 0 ," 186,760 ", 0 
Debt issuance costs,"(8,070)","(13,783)", 0 
Repayment of convertible notes,"(935,000)", 0 , 0 
Taxes paid related to net share settlement of equity awards,"(19,594)","(19,263)","(8,962)"
Payments of finance lease obligations,"(66,677)","(90,351)","(102,775)"
Proceeds from exercise of stock options, 788 ," 3,415 "," 9,444 "
Proceeds from issuances of common stock under employee stock purchase plan," 42,378 "," 29,288 "," 23,920 "
Net cash provided by (used in) financing activities,"(286,175)"," 978,116 ","(78,373)"
"Net increase (decrease) in cash, cash equivalents and restricted cash","(98,785)"," 262,314 "," 636,310 "
"Foreign exchange effect on cash, cash equivalents and restricted cash"," 4,576 ","(14,296)"," 9,914 "
"Cash, cash equivalents and restricted cash at beginning of period"," 1,921,875 "," 1,673,857 "," 1,027,633 "
"Cash, cash equivalents and restricted cash at end of period"," 1,827,666 "," 1,921,875 "," 1,673,857 "
Supplemental cash flow data,,,
Interest paid in cash," 12,236 "," 14,547 "," 13,990 "
Income taxes paid in cash," 20,144 "," 33,065 "," 16,216 "
Supplemental disclosures of non-cash investing and financing activities,,,
Common stock issued in connection with acquisitions, 0 ," 19,165 ", 0 
Right-of-Use Asset Obtained in Exchange for Finance Lease Liability, 0 ,,
Equipment purchases under finance leases,," 16,086 "," 123,235 "
Changes in accrued property and equipment purchases," 14,985 ","(23,469)"," 16,387 "
"Reconciliation of cash, cash equivalents and restricted cash as shown in the consolidated statements of cash flows",,,
Cash and cash equivalents," 1,799,082 "," 1,894,444 "," 1,638,413 "
"Total cash, cash equivalents and restricted cash"," $ 1,921,875 "," $ 1,673,857 "," $ 1,673,857 "